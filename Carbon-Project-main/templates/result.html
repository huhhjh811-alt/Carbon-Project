<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>SonuÃ§</title>
  <link rel="stylesheet" href="/static/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container narrow">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
      <h2 style="margin: 0;">Hesaplama Sonucu</h2>
      <div style="display: flex; gap: 12px; align-items: center;">
        <a class="btn ghost" href="/tips" style="text-decoration: none;">Ä°puÃ§larÄ±</a>
        <button class="theme-toggle" id="themeToggle" aria-label="Tema deÄŸiÅŸtir">ğŸŒ™</button>
      </div>
    </div>
    {% if error %}
      <p class="error">{{ error }}</p>
    {% else %}
      <p class="big">Toplam yÄ±llÄ±k tahmini COâ‚‚: <strong>{{ total }}</strong> kg</p>
      <p>KiÅŸi baÅŸÄ±: <strong>{{ per_person }}</strong> kg</p>

      <div class="level {{ level }}">
        {% if level == 'good' %}Ä°yi durum â€” dÃ¼ÅŸÃ¼k emisyon{% elif level == 'medium' %}Orta{% else %}YÃ¼ksek{% endif %}
      </div>

      <div class="chart-container">
        <canvas id="breakdownChart"></canvas>
      </div>

      <script>
        const ctx = document.getElementById('breakdownChart').getContext('2d');
        const breakdownData = {{ breakdown|tojson }};
        const labels = Object.keys(breakdownData);
        const values = Object.values(breakdownData);
        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        const colors = [
          'rgba(139, 92, 246, 0.8)',
          'rgba(16, 185, 129, 0.8)',
          'rgba(14, 165, 233, 0.8)',
          'rgba(245, 158, 11, 0.8)',
          'rgba(236, 72, 153, 0.8)'
        ];
        const hoverColors = [
          'rgba(139, 92, 246, 1)',
          'rgba(16, 185, 129, 1)',
          'rgba(14, 165, 233, 1)',
          'rgba(245, 158, 11, 1)',
          'rgba(236, 72, 153, 1)'
        ];
        new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: labels,
            datasets: [{
              data: values,
              backgroundColor: colors,
              borderColor: isDark ? '#374151' : '#ffffff',
              borderWidth: 3,
              hoverBackgroundColor: hoverColors,
              hoverBorderWidth: 4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  color: isDark ? '#f9fafb' : '#1f2937',
                  padding: 16,
                  font: {
                    size: 14,
                    weight: '500'
                  }
                }
              },
              tooltip: {
                backgroundColor: isDark ? '#1f2937' : '#ffffff',
                titleColor: isDark ? '#f9fafb' : '#1f2937',
                bodyColor: isDark ? '#d1d5db' : '#6b7280',
                borderColor: isDark ? '#374151' : '#e5e7eb',
                borderWidth: 1,
                padding: 12,
                displayColors: true,
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.parsed || 0;
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percentage = ((value / total) * 100).toFixed(1);
                    return label + ': ' + value + ' kg (' + percentage + '%)';
                  }
                }
              }
            },
            animation: {
              animateRotate: true,
              animateScale: true,
              duration: 1000
            }
          }
        });
      </script>

      <div class="result-actions">
        <a class="btn" href="/tips">Azaltma Ä°puÃ§larÄ±</a>
        <a class="btn ghost" href="/">Ana Sayfa</a>
      </div>
    {% endif %}
  </div>
  <script>
    const themeToggle = document.getElementById('themeToggle');
    const currentTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', currentTheme);
    themeToggle.textContent = currentTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
    themeToggle.addEventListener('click', () => {
      const theme = document.documentElement.getAttribute('data-theme');
      const newTheme = theme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      themeToggle.textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
      location.reload();
    });
  </script>
</body>
</html>